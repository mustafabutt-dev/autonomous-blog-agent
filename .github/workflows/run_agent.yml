name: Generate Blog Post

on:
  workflow_dispatch:
    inputs:
      topic:
        description: 'Blog topic'
        required: true
        type: string
      product:
        description: 'Product name (optional)'
        required: false
        type: string
      keywords:
        description: 'Keywords (comma-separated)'
        required: false
        type: string

jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        
        # Install agent_engine dependencies
        cd agent_engine
        pip install -r requirements.txt
        cd ..
        
        # Install mcp-servers dependencies  
        cd mcp-servers
        pip install -r requirements.txt
        cd ..
    
    - name: Generate Blog
      env:
        # Your custom env vars
        ASPOSE_LLM_API_KEY: ${{ secrets.ASPOSE_LLM_API_KEY }}
        ASPOSE_LLM_BASE_URL: ${{ secrets.ASPOSE_LLM_BASE_URL }}
        ASPOSE_LLM_MODEL: ${{ secrets.ASPOSE_LLM_MODEL }}
        SERPAPI_API_KEY: ${{ secrets.SERPAPI_API_KEY }}
        # Also set OPENAI_API_KEY if your code expects it
        OPENAI_API_KEY: ${{ secrets.ASPOSE_LLM_API_KEY }}
      run: |
        # Debug: Check if env vars are set (without exposing values)
        echo "Checking environment variables..."
        [ -z "$ASPOSE_LLM_API_KEY" ] && echo "ERROR: ASPOSE_LLM_API_KEY is not set" || echo "ASPOSE_LLM_API_KEY is set"
        [ -z "$OPENAI_API_KEY" ] && echo "ERROR: OPENAI_API_KEY is not set" || echo "OPENAI_API_KEY is set"
        
        cd agent_engine
        python -c "
        import os
        
        # Verify env vars in Python
        print('Environment check:')
        print(f'ASPOSE_LLM_API_KEY set: {bool(os.environ.get(\"ASPOSE_LLM_API_KEY\"))}')
        print(f'OPENAI_API_KEY set: {bool(os.environ.get(\"OPENAI_API_KEY\"))}')
        
        from agent_logic.orchestrator import BlogOrchestrator
        import asyncio
        
        orchestrator = BlogOrchestrator()
        result = asyncio.run(orchestrator.create_blog_autonomously(
            topic='${{ inputs.topic }}',
            product_name='${{ inputs.product }}'
        ))
        print(result)
        "